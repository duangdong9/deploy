(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{422:function(t,s,a){"use strict";a.r(s);var n=a(18),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"《docker环境下的前后端分离部署与运维》课程脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#《docker环境下的前后端分离部署与运维》课程脚本"}},[t._v("#")]),t._v(" 《Docker环境下的前后端分离部署与运维》课程脚本")]),t._v(" "),a("h3",{attrs:{id:"一、docker虚拟机常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、docker虚拟机常用命令"}},[t._v("#")]),t._v(" 一、Docker虚拟机常用命令")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("先更新软件包")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum -y update\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Docker虚拟机")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("运行、重启、关闭Docker虚拟机")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" start\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" restart\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop\n")])])])]),t._v(" "),a("li",[a("p",[t._v("搜索镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" search 镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("下载镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull 镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n")])])])]),t._v(" "),a("li",[a("p",[t._v("删除镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi 镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("运行容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run 启动参数  镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看容器列表")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a\n")])])])]),t._v(" "),a("li",[a("p",[t._v("停止、挂起、恢复容器")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop 容器ID\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pause 容器ID\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" unpase 容器ID\n")])])]),a("ol",{attrs:{start:"11"}},[a("li",[a("p",[t._v("查看容器信息")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect 容器ID\n")])])])]),t._v(" "),a("li",[a("p",[t._v("删除容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 容器ID\n")])])])]),t._v(" "),a("li",[a("p",[t._v("数据卷管理")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create 数据卷名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 数据卷名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除数据卷")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume inspect 数据卷名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看数据卷")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("网络管理")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" 查看网络信息\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network create --subnet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("网段 网络名称\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 网络名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("避免VM虚拟机挂起恢复之后，Docker虚拟机断网")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/sysctl.conf\n")])])]),a("p",[t._v("文件中添加"),a("code",[t._v("net.ipv4.ip_forward=1")]),t._v("这个配置")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启网络服务")]),t._v("\nsystemctl  restart network\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"二、安装pxc集群-负载均衡-双机热备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、安装pxc集群-负载均衡-双机热备"}},[t._v("#")]),t._v(" 二、安装PXC集群，负载均衡，双机热备")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("安装PXC镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull percona/percona-xtradb-cluster:5.7.21\n")])])]),a("p",[t._v("强烈推荐同学们安装5.7.21版本的PXC镜像，兼容性最好，在容器内可以执行apt-get安装各种程序包。最新版的PXC镜像内，无法执行apt-get，也就没法安装热备份工具了。")])]),t._v(" "),a("li",[a("p",[t._v("为PXC镜像改名")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag percona/percona-xtradb-cluster pxc\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建net1网段")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network create --subnet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.0/16 net1\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建5个数据卷")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create --name v1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create --name v2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create --name v3\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create --name v4\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create --name v5\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建备份数据卷（用于热备份数据）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create --name backup\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建5节点的PXC集群")]),t._v(" "),a("p",[t._v("注意，每个MySQL容器创建之后，因为要执行PXC的初始化和加入集群等工作，耐心等待1分钟左右再用客户端连接MySQL。另外，必须第1个MySQL节点启动成功，用MySQL客户端能连接上之后，再去创建其他MySQL节点。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第1个MySQL节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -v v1:/var/lib/mysql -v backup:/data --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第2个MySQL节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3307")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v2:/var/lib/mysql -v backup:/data --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node2 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.3 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第3个MySQL节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3308")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v3:/var/lib/mysql --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node3 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.4 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第4个MySQL节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3309")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v4:/var/lib/mysql --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node4 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.5 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第5个MySQL节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3310")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v5:/var/lib/mysql -v backup:/data --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node5 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.6 pxc\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Haproxy镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull haproxy\n")])])])]),t._v(" "),a("li",[a("p",[t._v("宿主机上编写Haproxy配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /home/soft/haproxy/haproxy.cfg\n")])])]),a("p",[t._v("配置文件如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[t._v("global\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#工作目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tchroot")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/etc/haproxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志文件，使用rsyslog服务中local5日志设备（/var/log/local5），等级info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tlog")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1 local5 info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#守护进程运行")]),t._v("\n\tdaemon\n\ndefaults\n\tlog\tglobal\n\tmode\thttp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志格式")]),t._v("\n\toption\thttplog\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志中不记录负载均衡的心跳检测记录")]),t._v("\n\toption\tdontlognull\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #连接超时（毫秒）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\ttimeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("connect 5000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #客户端超时（毫秒）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\ttimeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("client  50000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#服务器超时（毫秒）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("server  50000")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#监控界面\t")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" admin_stats")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#监控界面的访问的IP和端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tbind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 0.0.0.0:8888")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#访问协议")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    mode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       http")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#URI相对地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("uri   /dbs")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#统计报告格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("realm     Global\\ statistics")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#登陆帐户信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("auth  admin:abc123456")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据库负载均衡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" proxy-mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#访问的IP和端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tbind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 0.0.0.0:3306  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #网络协议")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tmode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" tcp")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#负载均衡算法（轮询算法）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#轮询算法：roundrobin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#权重算法：static-rr")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#最少连接算法：leastconn")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#请求源IP算法：source ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    balance")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" roundrobin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    option")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" tcplog")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#在MySQL中创建一个没有权限的haproxy用户，密码为空。Haproxy使用这个账户对MySQL数据库心跳检测")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    option")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" mysql-check user haproxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_1 172.18.0.2:3306 check weight 1 maxconn 2000  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_2 172.18.0.3:3306 check weight 1 maxconn 2000  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_3 172.18.0.4:3306 check weight 1 maxconn 2000 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_4 172.18.0.5:3306 check weight 1 maxconn 2000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_5 172.18.0.6:3306 check weight 1 maxconn 2000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#使用keepalive检测死链")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    option")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" tcpka  ")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建两个Haproxy容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第1个Haproxy负载均衡服务器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4001")]),t._v(":8888 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4002")]),t._v(":3306 -v /home/soft/haproxy:/usr/local/etc/haproxy --name h1 --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.7 haproxy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h1容器，启动Haproxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nhaproxy -f /usr/local/etc/haproxy/haproxy.cfg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第2个Haproxy负载均衡服务器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4003")]),t._v(":8888 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4004")]),t._v(":3306 -v /home/soft/haproxy:/usr/local/etc/haproxy --name h2 --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.8 haproxy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h2容器，启动Haproxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nhaproxy -f /usr/local/etc/haproxy/haproxy.cfg\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Haproxy容器内安装Keepalived，设置虚拟IP")])])]),t._v(" "),a("p",[t._v("注意事项：云主机不支持虚拟IP，另外很多公司的网络禁止创建虚拟IP（回家创建）,还有宿主机一定要关闭防火墙和SELINUX，很多同学都因为这个而失败的，切记切记")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h1容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件（参考下方配置文件）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机执行ping命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201\n")])])]),a("p",[t._v("配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vrrp_instance  VI_1 {\n    state  MASTER\n    interface  eth0\n    virtual_router_id  51\n    priority  100\n    advert_int  1\n    authentication {\n        auth_type  PASS\n        auth_pass  123456\n    }\n    virtual_ipaddress {\n        172.18.0.201\n    }\n}\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h2容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机执行ping命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201\n")])])]),a("p",[t._v("配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance  VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state  MASTER\n    interface  eth0\n    virtual_router_id  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type  PASS\n        auth_pass  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"11"}},[a("li",[a("p",[t._v("宿主机安装Keepalived，实现双机热备")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机执行安装Keepalived")]),t._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改Keepalived配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("p",[t._v("Keepalived配置文件如下：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       \t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.150\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.150 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr \n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.150 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr \n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("热备份数据")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入node1容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it node1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装热备工具")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" percona-xtrabackup-24\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全量热备")]),t._v("\ninnobackupex --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 /data/backup/full\n")])])])]),t._v(" "),a("li",[a("p",[t._v("冷还原数据\n停止其余4个节点，并删除节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop node2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop node3\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop node4\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop node5\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node3\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node4\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node5\n")])])]),a("p",[t._v("node1容器中删除MySQL的数据")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf /var/lib/mysql/*\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#清空事务")]),t._v("\ninnobackupex --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 --apply-back /data/backup/full/2018-04-15_05-09-07/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#还原数据")]),t._v("\ninnobackupex --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 --copy-back  /data/backup/full/2018-04-15_05-09-07/\n")])])]),a("p",[t._v("重新创建其余4个节点，组件PXC集群")])])]),t._v(" "),a("h2",{attrs:{id:"三、pxc-特别注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、pxc-特别注意事项"}},[t._v("#")]),t._v(" 三、PXC 特别注意事项")]),t._v(" "),a("h3",{attrs:{id:"pxc的主节点和从节点分别代表什么意义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pxc的主节点和从节点分别代表什么意义"}},[t._v("#")]),t._v(" PXC的主节点和从节点分别代表什么意义？")]),t._v(" "),a("p",[t._v("PXC中的主节点和从节点跟Replication主从节点是有巨大差别的。")]),t._v(" "),a("p",[t._v("首先Replication集群的数据同步只能是从主节点到从节点，而且节点的身份是固定的，主节点永远是Master，从节点永远是Slave，不能互换。")]),t._v(" "),a("p",[t._v("但是PXC上的主节点指的是第一个启动的节点，它不仅要启动MySQL服务，还要用Galera创建PXC集群。这些工作完成之后，主节点自动降级成普通节点。其他节点启动的时候只需要启动MySQL服务，然后再加入到PXC集群即可，所以这些节点从启动到关闭，身份一直都是普通节点。")]),t._v(" "),a("h3",{attrs:{id:"为什么node1能启动-而其他的pxc节点启动就闪退呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么node1能启动-而其他的pxc节点启动就闪退呢"}},[t._v("#")]),t._v(" 为什么Node1能启动，而其他的PXC节点启动就闪退呢？")]),t._v(" "),a("p",[t._v("这是因为Node1启动的时候要做跟多工作，上面已经提及了。所以你没等node1把PXC集群创建出来，你就飞快的启动其他PXC节点，它们找不到Node1启动的PXC集群，所以就自动闪退了。")]),t._v(" "),a("p",[t._v("正确的办法是启动Node1之后，等待10秒钟，然后用Navicat访问一下，能访问了，再去启动其他PXC节点")]),t._v(" "),a("p",[t._v("###如果PXC集群在运行的状态下，在宿主机上直接关机，或者停止Docker服务，为什么下次启动哪个PXC节点都会闪退？")]),t._v(" "),a("p",[t._v("这个要从PXC集群的节点管理说起，PXC节点的数据目录是/var/lib/mysql，好在这个目录被我们映射到数据卷上了。比如你访问v1数据卷就能看到node1的数据目录。这其中有个grastate.dat的文件，它里面有个safe_to_bootstrap参数被PXC用来记载谁是最后退出PXC集群的节点。比如node1是最后关闭的节点，那么PXC就会在把safe_to_bootstrap设置成1，代表node1节点最后退出，它的数据是最新的。下次启动必须先启动node1，然后其他节点与node1同步。")]),t._v(" "),a("p",[t._v("如果你在PXC节点都正常运行的状态下关闭宿主机Docker服务或者电源，那么PXC来不及判断谁是最后退出的节点，所有PXC节点一瞬间就都关上了，哪个节点的safe_to_boostrap参数就都是0。解决这个故障也很好办，那就是挑node1，把该参数改成1，然后正常启动node1，再启动其他节点就行了。")]),t._v(" "),a("h3",{attrs:{id:"pxc集群只有一个节点-关闭了这个节点的容器-下次还能启动起来吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pxc集群只有一个节点-关闭了这个节点的容器-下次还能启动起来吗"}},[t._v("#")]),t._v(" PXC集群只有一个节点，关闭了这个节点的容器，下次还能启动起来吗？")]),t._v(" "),a("p",[t._v("当然是可以的，因为PXC里只有一个节点，那么这个节点一定是按照主节点启动的，所以启动它的时候，它会启动MySQL服务，还创建出PXC集群。即便关闭了容器，下次再启动还是这个步骤，不会出现启动故障。如果说PXC集群是由多个节点组成的，node1停掉了，其他节点都正常运行。这时候启动node1是会出现闪退的，node1刚启动几秒钟就挂了。这是因为node2等一些节点正在现有的PXC中运行，这时候你启动node1，再创建一个同名的PXC集群，肯定会引发冲突啊。所以node1就闪退了。")]),t._v(" "),a("p",[t._v("遇到这种情况，正确的处理办法是，把node1容器删除。别紧张，没让你删除v1数据卷，所以数据丢不了。然后用从节点的命令方式创建一个node1，启动参数中与某个节点同步的设置就随便选择一个现在运行的PXC节点，然后Node1就能启动了。")]),t._v(" "),a("h3",{attrs:{id:"关于搭建技术体系-深入学习方面的感言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于搭建技术体系-深入学习方面的感言"}},[t._v("#")]),t._v(" 关于搭建技术体系，深入学习方面的感言")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("本门课程的数据库部分只讲到数据库集群怎么搭建，如果想要完全驾驭数据库，仅凭这点知识还是远远不够的。像我在PXC免费课中讲到的，我们首先要有一个明确的知识体系，下一步就是做知识分解，一点点把技术拼图给完成。我见过非常多，东学一下，西学一下的人，即便有10年的工作经验，依然难成大器。比如说前些年VR挺火的，现在区块链技术也挺火的。我是个快要毕业的大学生，我想学这些技术帮我找一份好的工作。其实这种想法不是不对，但是过于急功近利。我先把话题说的远一点，咱们一会儿再回来说技术规划的事情。\n\n在2013年，雷军和董明珠打了个赌，如果小米在5年内营业额超过格力，董明珠输给雷军10个亿，反之也是如此。两家企业相比较，大家更看好雷军的小米。这是因为中国的制造业利润太薄，制造业盈利存在上限的天花板，所以我们能准确预测出一家制造业企业未来的盈利空间。但是互联网公司就不是这样，想象空间太巨大。比如说马云的阿里巴巴，从1999年创建，到2014年上市，用了15年时间。刘强东的京东商城，差不多也用了15年时间上市。但是到了黄铮的拼多多这里，只用了3年时间就完成了上市，他还一举超过刘强东，成为中国第六富豪。IT界一夜成名的还有滴滴打车的程维、美团的王兴等等。\n\n也正是IT互联网公司造富神话太多，也就越来越多的资本涌入IT圈。有的资本公司做长线，但是更多的资本公司炒短线。先投资一家小公司，然后再制造行业舆论和技术导向，当人们被技术忽悠的疯狂的时候，有人肯接盘了，这时候再把投资的这家小公司卖掉，割一波韭菜就撤。于是我们看到太多太多被热炒的技术，没过1年时间就无人问津了。比如2014年的iOS技术，2015年的VR技术等等。当年VR技术被捧到天上，王雪红一度被业界认为会用VR让HTC翻身，可是到现在我们再也听不到HTC这家公司的新闻了。活着还是倒闭了，我们都不知道，大家也不关心。\n\n所以我们选择一个技术方向的时候，首先要看这个领域是不是有太多的水分，是不是有太多的热钱。比如今年3月的时候，真格基金的徐小平发了一个微博说自己非常看好以太坊技术，于是短短时间，中国各家资本公司纷纷涌入区块链领域。甚至还出现了2万块钱的区块链讲师速成班，不管懂不懂计算机，都能给你在短期内培养成区块链专家，然后你再去培训机构忽悠人，月薪两万，割学技术大学生的韭菜。我想，徐小平在微博上把区块链捧到天上，何尝不是一种资本炒作的手法呢。\n\n最后说回到技术领域这块。比如你是一个大学生，想投身一个有发展的技术方向，那么不妨拿起手机看看那些常用的APP上都用到了什么技术，这才是能落地能普及的。比如说刷抖音很容易上瘾，上划一条是你喜欢的视频，再上划一下，又是你感兴趣的视频。还有每个人打开淘宝APP，首页的内容都不一样，都是你喜欢的商品，看什么东西都想卖。淘宝也很绝，即使你不花钱买东西，只要你点击看了一个你喜欢的商品，从此以后，你各项爱好都被淘宝所感知了。这种技术是大数据上的协同过滤。说简单一点，就是掌握了你很少资料的情况下，去分析跟你有相同行为的人的喜好，于是推算出你的喜好。比如你点击了某个牌子的运动鞋，那么淘宝的协同过滤就会计算购买了这个运动鞋的用户，还买了什么东西，这些用户共性的东西，就是你的爱好。所以你再打开淘宝APP，看到的都是你喜欢的东西。抖音啊，今日头条啊，都是这样的技术。所以你学大数据，这个技术是能落地的，太多产品在用这个技术了。相比较而言，区块链和人工智能就显得太高冷了。不是说技术不好，但是距离大规模普及还是有很远的距离。比如说区块链吧，上半年好多企业都在炒作，不跟区块链挂钩好像都不是科技企业，甚至南方有家茶叶公司，把名字都改成了带有区块链字眼。这就像荷兰的郁金香泡沫，当人们都意识到郁金香根本就不值那么高价格的时候，于是泡沫就破裂了。比如极路由公司，把自己的路由器搞成了能挖矿，每天平均赚4块钱。我们知道1万块钱存到支付宝上，一天也产生不了1块钱的利益。现在几百块钱的极路由每天产生4块钱的收益，不就相当你花几百块钱享受几万块钱的利息收益吗，多让人疯狂啊。极路由一边忽悠消费者，一边又去忽悠投资人，还跟互联网金融公司合作，弄了多种套餐玩法。投资人和消费者都被忽悠热血沸腾，拿出十几万块钱，买极路由器，幻想自己在家当地主，天天几百块钱收入。但是不到半年时间，极路由的技术+金融戏法就玩不下去了，老板欠了3.5个亿跑路了。同学们也不妨搜索一下因为区块链破产的消费者和炒作者。你投身这样的领域觉得靠谱吗？\n\n所以选择技术规划一定要挑选成熟的，应用范围广泛的。比如大数据、Java体系、前端体系、Python体系等等。所以就像我在免费课里说到的，你选择好一个发力的方向，剩下的就是如何分解知识点了。比如说，你学了Java的一部分，没去深挖微服务架构和集群架构。如果你只停留在做单体项目，比如说SSM实现一个管理项目，VUE做一个网站等等，那我可以保证，你在IT开发这个领域很难坚持10年。经常听说，做开发30岁要转行，公司里几乎看不见40岁还做开发的人。其中的原因很多人没讲到关键点，作为创业者和企业家的角度来看，如果一个开发者，技术只停留在用SSM架构套各种业务，今天做一个管理系统，明天做一个管理系统。因为单体项目很难支撑高并发，所以你做的项目基本都是在小公司内部使用。随着你工作年限增加，对企业来说用人成本也就变高了。用一个2年经验的开发者，也会使用SSM做项目，成本还低，那为什么不用这样的人呢。所以你就被企业无情的抛弃了，根本原因是技术停滞，成本太高。这时候你再想跳槽到大企业，技术和年龄都达不到要求了。所以我建议年轻人，参加工作以后，虽然岗位有界限，但是技术无界限。前端、后台、数据库、原型设计、项目管理，多少都要学一些，没人教，就自己总结。只有技术全才，才能胜任技术团队的管理者，才不会被企业淘汰。\n\n其实我见过很多项目都是被不称职的管理者给弄黄的。也许你也有同感，这个项目A公司做过，B公司做过，现在客户找到我们又要重做一版，这是为什么呢？项目开发的失败率也太高了吧。这通常是项目管理者技术不过关导致的，比如说A客户去南方考察，觉得某公司的管理系统特别好，我想也做一套。于是找到了你，A客户是大老板，下面具体的业务细节说不太清楚，脑子里也没有清晰的想法，反正想到什么就东一句、西一句的，然后你贸然选用了瀑布模型开发。经过了需求分析、文档设计，总算进入到了开发。经过两个月的开发，终于可以拿出半成品给A客户了，这时候A客户说你做的不是他想要的东西，要不你推到重做把，要不我找别的公司去做。然后别的公司做了，A客户依然不满意，于是开启了无限的重做模式。\n\n究其原因还是管理者用错了开发模型，瀑布模型看似合理，但是问题在于编码阶段太靠后，等拿出半成品已经小半年时间过去了。因此瀑布模型适用于那种能提出明确需求，而且到每一处细节的客户。像A客户这样的人，我们应该用螺旋模型去开发，小规模快速迭代，只开发最核心模块，短期内就拿出演示品跟客户确认。这种小步快跑的策略适合提不出具体需求和需求不明确的场合。所以说，同学，以后你想做管理者，是不是得了解“软件工程”的知识啊！\n\n这几年我在教育部举办的互联网+创新创业大赛预赛和决赛当评委的时候，跟很多大学生创业的同学讲到了，你的创业想法很好，但是很可能项目会作废了。起初他们不相信，觉得自己拿到风投的钱，几个学软件的同学会编程，这就足够了。于是次年的时候，我又见到了这些同学，参赛的题目又换了。我就好奇的问他们，去年的创业项目做成了吗？他们跟我说，创业项目做砸了。呵呵，果然是这样。因为他们的团队里缺少了技术方面的全才。仅靠专才是不能完成项目开发的。我再举一个例子，某公司的开发者老张，他是做后端比较擅长，因为工作年头比较长了，于是就被提拔成了项目经理。有一天，日方客户发来一封邮件，说某模块的业务流程要修改，看看中方这边多长时间能实现，费用是多少。于是老张就召集团队的人开了一次会。老张擅长后台开发，这次需求觉得没什么难度，然后问了问数据库的哥们和前端的哥们，他们说也好实现，然后老张就承诺日方两天就能做完。但是过于乐观的态度，很容易引来噩梦般的后果。数据库的哥们和前端的哥们，写代码的时候才发现实现难度很大，最后花了半个月才做完，浪费了大量的加班费用。因为老张不懂前端，也不懂数据库集群，觉得底下人说什么就代表什么。由此看出，管理者技术必须全面，不能人云亦云，必须保持自己的判断力。\n\n说了这么多，也非常感谢大家在慕课网上支持我的课程，后续我还会在慕课网上录制更多的实战课，将我们的技术体系拼图给逐步完成。目前正在录制Python的课程和其他的开发课程，请大家稍加等待。下面列出来我在慕课网上所有课程的连接，以供大家学习。\n")])])]),a("p",[t._v("《MySQL数据库集群-PXC方案》")]),t._v(" "),a("p",[t._v("https://coding.imooc.com/class/274.html")]),t._v(" "),a("p",[t._v("《Docker环境下的前后端分离项目部署与运维》")]),t._v(" "),a("p",[t._v("https://coding.imooc.com/class/219.html")]),t._v(" "),a("h2",{attrs:{id:"安装redis-配置rediscluster集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装redis-配置rediscluster集群"}},[t._v("#")]),t._v(" 安装Redis，配置RedisCluster集群")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("安装Redis镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull yyyyttttwwww/redis\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建net2网段")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network create --subnet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.0/16 net2\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建6节点Redis容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name r1 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5001")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.2 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name r2 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5002")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.3 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name r3 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5003")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.4 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name r4 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5004")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.5 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name r5 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5005")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.6 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),a("p",[t._v("注意：redis配置文件里必须要设置bind 0.0.0.0，这是允许其他IP可以访问当前redis。如果不设置这个参数，就不能组建Redis集群。")])]),t._v(" "),a("li",[a("p",[t._v("启动6节点Redis服务器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r2节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r3节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r4节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r4 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r5节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r5 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r6节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r6 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建Cluster集群")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在r1节点上执行下面的指令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/cluster\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" redis-trib.rb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/cluster/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/cluster\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建Cluster集群")]),t._v("\n./redis-trib.rb create --replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.2:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.3:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.4:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.5:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.6:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.7:6379\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"打包部署后端项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包部署后端项目"}},[t._v("#")]),t._v(" 打包部署后端项目")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("进入人人开源后端项目，执行打包（修改配置文件，更改端口，打包三次生成三个JAR文件）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mvn clean "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -Dmaven.test.skip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Java镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull java\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建3节点Java容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷，上传JAR文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create j1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name j1 -v j1:/home/soft --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host java\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入j1容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it j1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" java -jar /home/soft/renren-fast.jar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷，上传JAR文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create j2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name j2 -v j2:/home/soft --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host java\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入j1容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it j2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" java -jar /home/soft/renren-fast.jar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷，上传JAR文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create j3\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name j3 -v j3:/home/soft --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host java\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入j1容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it j3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" java -jar /home/soft/renren-fast.jar\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Nginx镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建Nginx容器，配置负载均衡")]),t._v(" "),a("p",[t._v("宿主机上/home/n1/nginx.conf配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" nginx;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("worker_processes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("error_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/error.log warn;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pid")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       /var/run/nginx.pid;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    worker_connections")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1024;")]),t._v("\n}\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      /etc/nginx/mime.types;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    default_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" application/octet-stream;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    log_format")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("                      '$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('$body_bytes_sent "$http_referer" \'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('                      \'"$http_user_agent"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"$http_x_forwarded_for"\';')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    access_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/access.log  main;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    sendfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #tcp_nopush     on;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    keepalive_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 65;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #gzip  on;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_redirect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("         off;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       Host $host;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Real-IP $remote_addr;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Forwarded-For $proxy_add_x_forwarded_for;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("   10m;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_body_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  128k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_send_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_read_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       4k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("          4 32k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_busy_buffers_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 64k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_temp_file_write_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64k;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tupstream")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tomcat {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6001;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6002;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6003;")]),t._v("\n\t}\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      6101;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        server_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 192.168.99.104; ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/ {  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  http://tomcat;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" index.html index.htm;  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        }")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" ")]),t._v("\n    }\n}\n")])])]),a("p",[t._v("创建第1个Nginx节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name n1 -v /home/n1/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n\n")])])]),a("p",[t._v("宿主机上/home/n2/nginx.conf配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" nginx;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("worker_processes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("error_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/error.log warn;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pid")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       /var/run/nginx.pid;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    worker_connections")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1024;")]),t._v("\n}\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      /etc/nginx/mime.types;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    default_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" application/octet-stream;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    log_format")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("                      '$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('$body_bytes_sent "$http_referer" \'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('                      \'"$http_user_agent"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"$http_x_forwarded_for"\';')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    access_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/access.log  main;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    sendfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #tcp_nopush     on;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    keepalive_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 65;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #gzip  on;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_redirect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("         off;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       Host $host;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Real-IP $remote_addr;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Forwarded-For $proxy_add_x_forwarded_for;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("   10m;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_body_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  128k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_send_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_read_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       4k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("          4 32k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_busy_buffers_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 64k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_temp_file_write_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64k;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tupstream")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tomcat {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6001;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6002;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6003;")]),t._v("\n\t}\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      6102;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        server_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 192.168.99.104; ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/ {  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  http://tomcat;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" index.html index.htm;  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        }")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" ")]),t._v("\n    }\n}\n")])])]),a("p",[t._v("创建第2个Nginx节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name n2 -v /home/n2/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("在Nginx容器安装Keepalived")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入n1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it n1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vrrp_instance VI_1 {\n    state MASTER\n    interface ens33\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass 123456\n    }\n    virtual_ipaddress {\n        192.168.99.151\n    }\n}\nvirtual_server 192.168.99.151 6201 {\n    delay_loop 3\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout 50\n    protocol TCP\n    real_server 192.168.99.104 6101 {\n        weight 1\n    }\n}\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入n1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it n2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6201")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6102")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"打包部署后端项目-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包部署后端项目-2"}},[t._v("#")]),t._v(" 打包部署后端项目")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在前端项目路径下执行打包指令")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n")])])])]),t._v(" "),a("li",[a("p",[t._v("build目录的文件拷贝到宿主机的/home/fn1/renren-vue、/home/fn2/renren-vue、/home/fn3/renren-vue的目录下面")])]),t._v(" "),a("li",[a("p",[t._v("创建3节点的Nginx，部署前端项目")]),t._v(" "),a("p",[t._v("宿主机/home/fn1/nginx.conf的配置文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('user  nginx;\nworker_processes  1;\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\t\n\tproxy_redirect          off;\n\tproxy_set_header        Host $host;\n\tproxy_set_header        X-Real-IP $remote_addr;\n\tproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n\tclient_max_body_size    10m;\n\tclient_body_buffer_size   128k;\n\tproxy_connect_timeout   5s;\n\tproxy_send_timeout      5s;\n\tproxy_read_timeout      5s;\n\tproxy_buffer_size        4k;\n\tproxy_buffers           4 32k;\n\tproxy_busy_buffers_size  64k;\n\tproxy_temp_file_write_size 64k;\n\t\n\tserver {\n\t\tlisten 6501;\n\t\tserver_name  192.168.99.104;\n\t\tlocation  /  {\n\t\t\troot  /home/fn1/renren-vue;\n\t\t\tindex  index.html;\n\t\t}\n\t}\n}\n')])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动第fn1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name fn1 -v /home/fn1/nginx.conf:/etc/nginx/nginx.conf -v /home/fn1/renren-vue:/home/fn1/renren-vue --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host nginx\n")])])]),a("p",[t._v("宿主机/home/fn2/nginx.conf的配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6502")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tlocation  /  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\troot  /home/fn2/renren-vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tindex  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动第fn2节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name fn2 -v /home/fn2/nginx.conf:/etc/nginx/nginx.conf -v /home/fn2/renren-vue:/home/fn2/renren-vue --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host nginx\n")])])]),a("p",[t._v("宿主机/home/fn3/nginx.conf的配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tlocation  /  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\troot  /home/fn3/renren-vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tindex  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("启动fn3节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动第fn3节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name fn3 -v /home/fn3/nginx.conf:/etc/nginx/nginx.conf -v /home/fn3/renren-vue:/home/fn3/renren-vue --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置负载均衡")]),t._v(" "),a("p",[t._v("宿主机/home/ff1/nginx.conf配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tupstream fn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6501"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6502"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6503"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6601")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            proxy_pass   http://fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动ff1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name ff1 -v /home/ff1/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n")])])]),a("p",[t._v("宿主机/home/ff2/nginx.conf配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tupstream fn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6501"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6502"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6503"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6602")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            proxy_pass   http://fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动ff2节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -it -d --name ff2 -v /home/ff2/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置双机热备")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入ff1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ff1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.152\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6701")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6601")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入ff1节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ff2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.152\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6701")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6602")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);